(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{6499:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payments/add",function(){return t(5858)}])},5858:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return x}});var s=t(5893),i=t(8804),o=t(7312),r=t(7294),a=t(7536),l=t(1758),c=t(1019),d=t(6650),u=t(5696),m=t(1365),p=t(1163),h=t(8063),f=t.n(h);function x(){var e,n;let[t,h]=(0,r.useState)(["Payment to bank:",...f().bank_details,"Fees: ".concat(f().currency).concat(f().registration_fee," per contestant")]),[x,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!0),{register:v,handleSubmit:j,formState:{errors:N},watch:w,setValue:P}=(0,a.cI)(),k=w("proof"),[_,O]=(0,r.useReducer)(m.I,{}),S=(0,p.useRouter)(),C=async e=>{g(!0),b(!1);let n=e.amount?e.amount.trim():"",t=e.proof?e.proof[0]:null;null!=t&&(0,c.jM)((0,c.iH)(u.db,"payments/".concat(u.I.currentUser.uid)),e=>{let s=function(){let e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=new Date().valueOf(),t="";do t=e[n%62]+t,n=Math.floor(n/62);while(n>0);for(let n=0;n<5;n++)t+=e[Math.floor(62*Math.random())];return t}(),i=e.exists()?Object.keys(e.val()).length+1+1e4:10001,o=t.name.split(".").pop();console.log("paymentProof/".concat(u.I.currentUser.uid,"/").concat(i,"-").concat(s,".").concat(o));let r=(0,d.iH)((0,d.cF)(),"paymentProof/".concat(u.I.currentUser.uid,"/").concat(i,"-").concat(s,".").concat(o));(0,d.KV)(r,t).then(async()=>{try{let e={};e.amount=n,e.fileExtension=o,e.uniqueId=s,await (0,c.Vx)((0,c.iH)(u.db,"payments/".concat(u.I.currentUser.uid,"/").concat(i)),e),O({title:"Success",icon:"checkmark",children:"Payment has been successfully uploaded.",hidden:!1,mainText:"OK",mainColors:"bg-green-600",mainOnClick:()=>{O({hidden:!0}),S.push("/payments")},secondaryShow:!1}),g(!1)}catch(e){console.log(e),O({title:"Error.",icon:"error",children:"There was an error processing your payment. Please contact us if problem persists.",hidden:!1,mainText:"OK",mainColors:"bg-red-600",mainOnClick:()=>{O({hidden:!0})},secondaryShow:!1}),b(!0),g(!1)}}).catch(e=>{console.log(e),O({title:"Error.",icon:"error",children:"There was an error uploading your file. Please contact us if problem persists.",hidden:!1,mainText:"OK",mainColors:"bg-red-600",mainOnClick:()=>{O({hidden:!0})},secondaryShow:!1}),b(!0),g(!1)})},{onlyOnce:!0})};return(0,s.jsxs)(o.Z,{title:"Add Payment",children:[(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"w-full space-y-8 max-w-md",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900",children:"Add Payment"})}),(0,s.jsx)("div",{className:"text-center text-sm",children:"string"==typeof t?t:t.map((e,n)=>(0,s.jsx)("p",{children:e},n))}),(0,s.jsxs)("form",{className:"space-y-6 w-full",onSubmit:j(C),noValidate:!0,children:[(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,l.Z)({inputName:"Amount",placeholder:String(f().registration_fee),hook:v("amount",{required:"Amount is required",pattern:{value:/^[0-9]+.?[0-9]{0,2}$/,message:"Amount must be a number"},min:{value:1,message:"Amount must be at least 1"}}),errorMsg:null===(e=N.amount)||void 0===e?void 0:e.message}),(0,s.jsxs)("div",{className:"col-span-full",children:[(0,s.jsx)("label",{htmlFor:"cover-photo",className:"px-2 py-1",children:"Payment Proof"}),(0,s.jsx)("div",{className:"px-2 text-sm",children:null===(n=N.proof)||void 0===n?void 0:n.message}),k?(0,s.jsxs)("div",{className:"px-2 text-sm",children:["Uploaded: ",k[0].name,"."," ",(0,s.jsx)("div",{className:"inline-block font-semibold text-indigo-600 hover:text-indigo-500 hover:cursor-pointer",onClick:()=>P("proof",null),children:"Remove"})]}):(0,s.jsx)("div",{className:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"mt-4 flex text-sm leading-6 text-gray-600",children:[(0,s.jsxs)("label",{htmlFor:"proof",className:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500",children:[(0,s.jsx)("span",{children:"Upload a file"}),(0,s.jsx)("input",{id:"proof",type:"file",className:"sr-only",...v("proof",{required:"Payment proof is required",validate:{lessThan3MB:e=>e&&e[0].size<3e6||"File must be less than 3MB",acceptedFormats:e=>e&&["image/png","image/jpeg","application/pdf"].includes(e[0].type)||"Unsupported Format",onlyOneFile:e=>e&&1===e.length||"Only one file is allowed"}})})]}),(0,s.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,s.jsx)("p",{className:"text-xs leading-5 text-gray-600",children:"PNG, JPG, PDF up to 3MB"})]})})]})]})}),(0,s.jsx)(i.Z,{full:!0,props:{type:"submit"},isLoading:x,disabled:!y,children:"Submit Payment"})]})]})}),(0,m.Z)(_)]})}}},function(e){e.O(0,[627,257,414,536,650,634,888,774,179],function(){return e(e.s=6499)}),_N_E=e.O()}]);