(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{6499:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payments/add",function(){return t(8887)}])},8887:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var s=t(5893),o=t(3067),i=t(8240),a=t(7294),r=t(7536),l=t(3188),c=t(1019),d=t(6650),u=t(1481),m=t(130),p=t(1163);function h(){var e,n;let[t,h]=(0,a.useState)(["Payment to bank:","My Bank","0000000","Fees: RM15/contestant"]),[x,f]=(0,a.useState)(!1),[g,y]=(0,a.useState)(!0),{register:b,handleSubmit:v,formState:{errors:j},watch:N,setValue:w}=(0,r.cI)(),k=N("proof"),[P,O]=(0,a.useReducer)(m.I,{}),_=(0,p.useRouter)(),M=async e=>{f(!0),y(!1);let n=e.amount?e.amount.trim():"",t=e.proof?e.proof[0]:null;null!=t&&(0,c.jM)((0,c.iH)(u.db,"payments/".concat(u.I.currentUser.uid)),e=>{let s=function(){let e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=new Date().valueOf(),t="";do t=e[n%62]+t,n=Math.floor(n/62);while(n>0);for(let n=0;n<5;n++)t+=e[Math.floor(62*Math.random())];return t}(),o=e.exists()?Object.keys(e.val()).length+1+1e4:10001,i=t.name.split(".").pop();console.log("paymentProof/".concat(u.I.currentUser.uid,"/").concat(o,"-").concat(s,".").concat(i));let a=(0,d.iH)((0,d.cF)(),"paymentProof/".concat(u.I.currentUser.uid,"/").concat(o,"-").concat(s,".").concat(i));(0,d.KV)(a,t).then(async()=>{console.log("Uploaded");try{let e={};e.amount=n,e.fileExtension=i,e.uniqueId=s,await (0,c.Vx)((0,c.iH)(u.db,"payments/".concat(u.I.currentUser.uid,"/").concat(o)),e),O({title:"Success",icon:"checkmark",children:"Payment has been successfully uploaded.",hidden:!1,mainText:"OK",mainColors:"bg-green-600",mainOnClick:()=>{O({hidden:!0}),_.push("/payments")},secondaryShow:!1}),f(!1)}catch(e){console.log(e),O({title:"Error.",icon:"error",children:"There was an error processing your payment. Please contact us if problem persists.",hidden:!1,mainText:"OK",mainColors:"bg-red-600",mainOnClick:()=>{O({hidden:!0})},secondaryShow:!1}),y(!0),f(!1)}}).catch(e=>{console.log(e),O({title:"Error.",icon:"error",children:"There was an error uploading your file. Please contact us if problem persists.",hidden:!1,mainText:"OK",mainColors:"bg-red-600",mainOnClick:()=>{O({hidden:!0})},secondaryShow:!1}),y(!0),f(!1)})},{onlyOnce:!0})};return(0,s.jsxs)(i.Z,{children:[(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"w-full space-y-8 max-w-md",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900",children:"Add Payment"})}),(0,s.jsx)("div",{className:"text-center text-sm",children:"string"==typeof t?t:t.map((e,n)=>(0,s.jsx)("p",{children:e},n))}),(0,s.jsxs)("form",{className:"space-y-6 w-full",onSubmit:v(M),noValidate:!0,children:[(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,l.Z)({inputName:"Amount",placeholder:"10",hook:b("amount",{required:"Amount is required",pattern:{value:/^[0-9]+.?[0-9]{0,2}$/,message:"Amount must be a number"},min:{value:1,message:"Amount must be at least 1"}}),errorMsg:null===(e=j.amount)||void 0===e?void 0:e.message}),(0,s.jsxs)("div",{className:"col-span-full",children:[(0,s.jsx)("label",{htmlFor:"cover-photo",className:"px-2 py-1",children:"Payment Proof"}),(0,s.jsx)("div",{className:"px-2 text-sm",children:null===(n=j.proof)||void 0===n?void 0:n.message}),k?(0,s.jsxs)("div",{className:"px-2 text-sm",children:["Uploaded: ",k[0].name,"."," ",(0,s.jsx)("div",{className:"inline-block font-semibold text-indigo-600 hover:text-indigo-500 hover:cursor-pointer",onClick:()=>w("proof",null),children:"Remove"})]}):(0,s.jsx)("div",{className:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"mt-4 flex text-sm leading-6 text-gray-600",children:[(0,s.jsxs)("label",{htmlFor:"proof",className:"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500",children:[(0,s.jsx)("span",{children:"Upload a file"}),(0,s.jsx)("input",{id:"proof",type:"file",className:"sr-only",...b("proof",{required:"Payment proof is required",validate:{lessThan3MB:e=>e&&e[0].size<3e6||"File must be less than 3MB",acceptedFormats:e=>e&&["image/png","image/jpeg","application/pdf"].includes(e[0].type)||"Unsupported Format",onlyOneFile:e=>e&&1===e.length||"Only one file is allowed"}})})]}),(0,s.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,s.jsx)("p",{className:"text-xs leading-5 text-gray-600",children:"PNG, JPG, PDF up to 3MB"})]})})]})]})}),(0,s.jsx)(o.Z,{full:!0,props:{type:"submit"},isLoading:x,disabled:!g,children:"Submit Payment"})]})]})}),(0,m.Z)(P)]})}}},function(e){e.O(0,[627,18,273,536,650,669,774,888,179],function(){return e(e.s=6499)}),_N_E=e.O()}]);