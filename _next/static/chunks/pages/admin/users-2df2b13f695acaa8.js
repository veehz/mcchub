(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{4168:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return n(9698)}])},1758:function(e,s,n){"use strict";n.d(s,{Z:function(){return t}});var l=n(5893);function t(e){let{id:s,inputName:n,placeholder:t,hook:a,disabled:r=!1,errorMsg:d,props:i}=e;return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"px-2 py-1",children:(0,l.jsx)("label",{htmlFor:s,children:void 0===n?t:n||null})}),(0,l.jsx)("input",{type:"text",className:"rounded-md relative block w-full border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 disabled:opacity-75 disabled:bg-slate-100"+(d?" ring-red-500":""),disabled:r,id:s,placeholder:t,...i,...a}),(0,l.jsx)("div",{className:"px-2 py-1",children:(0,l.jsx)("div",{className:"text-sm text-red-500",children:d})})]})}},9698:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return b}});var l=n(5893),t=n(8804),a=n(7312),r=n(1758),d=n(5696),i=n(1019),o=n(7294),c=n(8917),u=n(1664),h=n.n(u),v=n(1163),m=n(8063),p=n.n(m);let x=(e,s)=>e+s,j={and:(e,s)=>e&&s,or:(e,s)=>e||s,xor:(e,s)=>e!=s},f={and:!0,or:!1,xor:!1},g=e=>{var s,n,a,r;let{userId:u,users:v,nricData:m,role:g,managedStudents:b,payments:y,searchKey:N}=e,[k,w]=(0,o.useState)(!1),[O,S]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(N){w(!0);let e=N.trim().split(" ").map(e=>e.toLowerCase().trim()).filter(e=>e.length>0),s=[],n={};for(let l of e)if(l.includes(":")){let[e,s]=l.split(":");n[e]=s}else s.push(l);let l=[];for(let e of s){let s=!1;for(let n of Object.keys(v[u]))if(v[u][n].toLowerCase().includes(e)){s=!0;break}l.push(s)}if("true"==n.due){let e=Object.keys(b).length*p().registration_fee,s=Object.keys(y).filter(e=>{var s,n;return(null===(n=y[e])||void 0===n?void 0:null===(s=n.approved)||void 0===s?void 0:s.status)=="approved"}).map(e=>parseFloat(y[e].amount)).reduce(x,0);l.push(e>s)}n.role&&l.push(g==n.role),n.managerof&&l.push(n.managerof in b);let t=l.reduce(j.and,f.and);n.searchtype&&n.searchtype in j&&(t=l.reduce(j[n.searchtype],f[n.searchtype])),"true"==n.not&&(t=!t),w(!t)}else w(!1)},[N,y,b,g,u,v]),(0,l.jsxs)("div",{className:"rounded-lg overflow-hidden shadow-lg p-4 mb-4"+(k?" hidden":""),children:[(0,l.jsxs)("div",{className:"font-bold text-xl mb-2",children:[null===(s=v[u])||void 0===s?void 0:s.name,": ",v[u].email]}),(0,l.jsx)("div",{className:"text-gray-700 text-base mb-2",children:(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:"User ID"}),": ",u]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Role"}),": ",g]}),Object.keys(v[u]).filter(e=>!["email","name","nric"].includes(e)).map(e=>(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:function(e){let s=e.split(" ");for(let e=0;e<s.length;e++)s[e]=s[e].charAt(0).toUpperCase()+s[e].slice(1);return s.join(" ")}(e)}),":"," ",v[u][e]]},e)),"teacher"==g||"parent"==g?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-bold",children:["Payments: ",y?Object.keys(y).length:null," ","(Approved:"," ",y?Object.keys(y).filter(e=>{var s,n;return(null===(n=y[e])||void 0===n?void 0:null===(s=n.approved)||void 0===s?void 0:s.status)=="approved"}).length:null,", Pending:"," ",y?Object.keys(y).filter(e=>{var s,n,l,t;return!(null===(n=y[e])||void 0===n?void 0:null===(s=n.approved)||void 0===s?void 0:s.status)||(null===(t=y[e])||void 0===t?void 0:null===(l=t.approved)||void 0===l?void 0:l.status)=="pending"}).length:null,", Rejected:"," ",y?Object.keys(y).filter(e=>{var s,n;return(null===(n=y[e])||void 0===n?void 0:null===(s=n.approved)||void 0===s?void 0:s.status)=="rejected"}).length:null,")"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Need to pay:"})," ",Object.keys(b).length*p().registration_fee]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Approved Payment:"})," ",Object.keys(y).filter(e=>{var s,n;return(null===(n=y[e])||void 0===n?void 0:null===(s=n.approved)||void 0===s?void 0:s.status)=="approved"}).map(e=>parseFloat(y[e].amount)).reduce(x,0)]})]}):null,"teacher"==g||"parent"==g?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-bold",children:["Students: ",Object.keys(b||{}).length]}),(0,l.jsx)("div",{className:"flex flex-col",children:Object.keys(b||{}).map(e=>{var s,n;return(0,l.jsxs)("div",{className:(null===(s=m[e])||void 0===s?void 0:s.student)?"text-green-500":"text-red-500",children:[e," ",(null===(n=m[e])||void 0===n?void 0:n.student)?(0,l.jsxs)("div",{children:["(",v[m[e].student].email,","," ",(0,l.jsx)("span",{className:"text-blue-600 font-bold hover:opacity-75 cursor-pointer",onClick:()=>{let s={};s["managedStudents/".concat(u,"/").concat(e)]=null,s["nric/".concat(v[m[e].student].nric,"/manager")]=null,(0,i.Vx)((0,i.iH)(d.db),s)},children:"Unbind"}),")"]}):null]},e)})})]}):null,"student"==g&&(null===(n=v[u])||void 0===n?void 0:n.nric)?(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"font-bold",children:["NRIC/Passport Number:"," ",(0,l.jsxs)("span",{className:(null===(a=m[v[u].nric])||void 0===a?void 0:a.manager)?"text-green-500":"text-red-500",children:[v[u].nric," ",(null===(r=m[v[u].nric])||void 0===r?void 0:r.manager)?"(manager: ".concat(v[m[v[u].nric].manager].email,")"):null]})]})}):null]})}),(0,l.jsxs)("div",{className:"flex flex-wrap",children:[(0,l.jsx)(h(),{href:{pathname:"/admin/users/edit",query:{id:u}},children:(0,l.jsx)(t.Z,{className:"mx-2 my-1",children:"Edit User"})}),"teacher"==g||"parent"==g?(0,l.jsx)(t.Z,{className:"mx-2 my-1",onClick:()=>S(!O),children:O?"Hide Payments":"View Payments"}):null]}),y&&O?Object.keys(y).map(e=>(0,l.jsx)(c.PaymentCard,{payment:{...y[e],userId:u,paymentId:e},showUid:!1},u+"-"+e)):null]})};function b(){let[e,s]=(0,o.useState)(!1),[n,c]=(0,o.useState)(""),[u,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)({}),[x,j]=(0,o.useState)({}),[f,b]=(0,o.useState)({}),[y,N]=(0,o.useState)({}),[k,w]=(0,o.useState)({});function O(){e||(s(!0),(0,i.jM)((0,i.iH)(d.db,"users"),e=>{console.log("users",e.val()),p(e.val()||{})}),(0,i.jM)((0,i.iH)(d.db,"nric"),e=>{console.log("nric",e.val()),b(e.val()||{})}),(0,i.jM)((0,i.iH)(d.db,"role"),e=>{console.log("role",e.val()),j(e.val()||{})}),(0,i.jM)((0,i.iH)(d.db,"managedStudents"),e=>{console.log("managedStudents",e.val()),N(e.val()||{})}),(0,i.jM)((0,i.iH)(d.db,"payments"),e=>{console.log("payments",e.val()),w(e.val()||{})}))}let S=(0,v.useRouter)();return(0,o.useEffect)(()=>{var e;(null==S?void 0:null===(e=S.query)||void 0===e?void 0:e.fetch)&&O()}),(0,l.jsx)(a.Z,{title:"Users",children:(0,l.jsxs)("div",{className:"place-content-center w-full",children:[(0,l.jsx)(t.Z,{className:"mx-auto"+(e?" hidden":""),onClick:()=>O(),children:"Fetch All Users"}),(0,l.jsxs)("div",{hidden:!e,children:[(0,l.jsxs)("div",{className:"text-gray-500 text-center",children:[(0,l.jsx)("div",{hidden:Object.keys(m).length>0,children:"Loading Users Data"}),(0,l.jsx)("div",{hidden:Object.keys(f).length>0,children:"Loading NRIC Data"})]}),(0,l.jsx)(r.Z,{placeholder:"Search",inputName:null,props:{onChange:e=>{c(e.target.value)}}}),(0,l.jsx)("div",{className:"mx-2 text-sm underline text-blue-500 cursor-pointer hover:opacity-90",onClick:()=>{h(!u)},children:"Advanced Search Guide"}),(0,l.jsxs)("div",{className:"mx-2 text-sm m-2 p-2 rounded-md border border-solid border-black",hidden:!u,children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-mono bg-gray-200",children:"due:true"})," shows teachers whose approved payments are not enough to cover the registration fees."]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-mono bg-gray-200",children:"role:student | parent | teacher | admin"})," ","shows users with the respective role."]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-mono bg-gray-200",children:"managerof:[nric]"})," ","shows users with [nric] as their managed student."]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-mono bg-gray-200",children:"searchtype:and | or | xor"})," ","determines the search type (default: and)"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-mono bg-gray-200",children:"not:true"})," inverts the search results"]})]}),(0,l.jsx)("div",{className:"flex flex-col",children:Object.keys(m).map(e=>(0,l.jsx)(g,{userId:e,users:m,nricData:f,role:x[e],managedStudents:y[e]||{},payments:k[e]||{},searchKey:n},e))})]})]})})}}},function(e){e.O(0,[627,257,414,650,917,888,774,179],function(){return e(e.s=4168)}),_N_E=e.O()}]);