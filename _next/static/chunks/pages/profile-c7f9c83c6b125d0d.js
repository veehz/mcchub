(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[283],{9813:function(e,i,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return l(7078)}])},8945:function(e,i,l){"use strict";l.d(i,{Z:function(){return n}});var r=l(5893);function n(e){let{id:i,inputName:l,placeholder:n,hook:s,disabled:t=!1,errorMsg:d,props:o}=e;return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("div",{className:"px-2 py-1",children:(0,r.jsx)("label",{htmlFor:i,children:void 0===l?n:l||null})}),(0,r.jsx)("input",{type:"date",className:"rounded-md relative block w-full border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 disabled:opacity-75 disabled:bg-slate-100"+(d?" ring-red-500":""),disabled:t,id:i,placeholder:n,...o,...s}),(0,r.jsx)("div",{className:"px-2 py-1",children:(0,r.jsx)("div",{className:"text-sm text-red-500",children:d})})]})}l(7294)},3758:function(e,i,l){"use strict";l.d(i,{Z:function(){return n}});var r=l(5893);function n(e){let{title:i,hidden:l=!1,children:n,props:s}=e;return(0,r.jsxs)("div",{hidden:l,className:"space-y-2 rounded-md p-4 border-solid border-2 border-indigo-600",...s,children:[(0,r.jsx)("div",{className:"font-bold text-center text-xl",children:i}),n]})}},1454:function(e,i,l){"use strict";l.d(i,{Z:function(){return n}});var r=l(5893);function n(e){let{children:i,id:l,disabled:n=!1,hook:s={},value:t}=e;return(0,r.jsxs)("div",{className:"flex space-x-2 p-1 text-sm font-bold "+(n?" text-gray-400":""),children:[(0,r.jsx)("input",{disabled:n,type:"radio",id:l,...s,className:"inline-block",value:void 0===t?l:t}),(0,r.jsx)("label",{className:"inline-block w-full",htmlFor:l,children:i})]})}},3706:function(e,i,l){"use strict";l.d(i,{Z:function(){return n}});var r=l(5893);function n(e){let{title:i,children:l,errorMsg:n}=e;return(0,r.jsxs)("div",{className:"space-y-0",children:[(0,r.jsxs)("div",{className:"px-2 py-1",children:[i," ",(0,r.jsx)("span",{className:"text-sm text-red-500",children:n})]}),l]})}},432:function(e){"use strict";e.exports={nric:/[0-9]{2}[0-1][0-9][0-3][0-9]-[0-9]{2}-[0-9]{4}/,passport:/[A-Z0-9]{1,9}/,phone:/\+?[\d ]{1,6}[- ]?[\d ]{1,15}/,dob:/\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])/,email:/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,amount:/\d+(\.\d{1,2})?/}},7078:function(e,i,l){"use strict";l.r(i),l.d(i,{default:function(){return A}});var r=l(5893),n=l(8804),s=l(7312),t=l(7294),d=l(7536),o=l(5696),a=l(1019),c=l(1259),u=l(3758),h=l(1758),x=l(1454),m=l(3706),f=l(8945),p=l(1664),b=l.n(p),g=l(1365),v=l(1163),y=l(8063),j=l.n(y),N=l(432),k=l.n(N);function A(){var e,i,l,p,y,N,A;let{register:S,formState:{errors:w},handleSubmit:C,setValue:Z}=(0,d.cI)(),[P,M]=(0,t.useState)(!1),[_,z]=(0,t.useState)(!1),[I,O]=(0,t.useState)(""),L=(0,v.useRouter)(),[E,F]=(0,t.useReducer)(g.I,{}),[U,B]=(0,t.useState)({}),[T,D]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(0,c.Aj)(o.I,async e=>{if(e){var i,l;T||(D(!0),(0,a.jM)((0,a.iH)(o.db,"role/"+(null===(i=o.I.currentUser)||void 0===i?void 0:i.uid)),e=>{O(e.val())},{onlyOnce:!0}),(0,a.jM)((0,a.iU)((0,a.iH)(o.db),"users/"+(null===(l=o.I.currentUser)||void 0===l?void 0:l.uid)),e=>{for(let i in B(e.val()),e.val())Z(i,e.val()[i]);M(!0)},{onlyOnce:!0}))}})});let H=e=>{let{hook:i,id:l,inputName:n,placeholder:s,children:t,errorMsg:d}=e;return(0,r.jsx)(h.Z,{hook:i,id:l,inputName:n,placeholder:s,disabled:!P,errorMsg:d,children:t})},K=j().genders;return(0,r.jsxs)(s.Z,{title:"Profile",children:[(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"w-full space-y-8 max-w-md",children:[(0,r.jsx)("div",{children:(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900",children:"Your Profile"})}),(0,r.jsxs)("form",{className:"mt-8 space-y-6 w-full",onSubmit:C(e=>{var i;z(!0),M(!1);let l={};for(let i in e)if("nric"!=i){if((e[i]||"")!==(U[i]||"")){let r=e[i];l[i]=r||""}if(i.startsWith("billingAddress")&&l[i]){let e=l[i];delete l[i];let r=i.slice(14);l["billingAddress/"+(r=r.charAt(0).toLowerCase()+r.slice(1))]=e}}(0,a.Vx)((0,a.iU)((0,a.iH)(o.db),"users/"+(null===(i=o.I.currentUser)||void 0===i?void 0:i.uid)),l).then(()=>{z(!1),M(!0),F({hidden:!1,title:"Profile Updated Successfully",children:"",icon:"checkmark",mainText:"OK",mainOnClick:()=>{F({hidden:!0}),L.push("/dashboard")},mainColors:"bg-green-600",secondaryShow:!1})}).catch(e=>{z(!1),M(!0),F({hidden:!1,title:"Error",children:"An error occurred. Please try again later. If problem persists, please contact us.",icon:"error",mainText:"OK",mainOnClick:()=>{F({hidden:!0})},mainColors:"bg-red-600",secondaryShow:!1})})}),noValidate:!0,children:["student"==I&&Object.keys(U).length&&!U.nric?(0,r.jsx)(b(),{href:"/profile/bind-nric",children:(0,r.jsx)(n.Z,{full:!0,children:"Bind your account to an NRIC Number/Passport Number"})}):null,(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(u.Z,{title:"Personal Information",children:[H({hook:S("name",{required:"Full name is required."}),id:"name",placeholder:"Full Name",errorMsg:null==w?void 0:null===(e=w.name)||void 0===e?void 0:e.message}),(0,r.jsx)(m.Z,{title:"Gender",errorMsg:null==w?void 0:null===(i=w.gender)||void 0===i?void 0:i.message,children:Object.keys(K).map(e=>(0,r.jsx)(x.Z,{id:e,hook:S("gender"),disabled:!P,children:K[e]},e))})]}),(0,r.jsxs)(u.Z,{title:"Student Information",hidden:"student"!=I,children:[H({hook:S("school"),id:"school",placeholder:"School",errorMsg:null==w?void 0:null===(l=w.school)||void 0===l?void 0:l.message}),(0,r.jsx)(f.Z,{hook:S("dob",{validate:e=>"student"!=I||(!e||e.length<1?"Please fill in your Date of Birth.":void 0)}),id:"dob",inputName:"Date of Birth",placeholder:"Date of Birth",errorMsg:null==w?void 0:null===(p=w.dob)||void 0===p?void 0:p.message}),H({hook:S("form",{validate:e=>"student"!=I||(!e||e.length<1?"Please fill in your form/year.":void 0)}),id:"name",inputName:"Form/Year",placeholder:"Form/Year (e.g. Form 4, Standard 6)",errorMsg:null==w?void 0:null===(y=w.form)||void 0===y?void 0:y.message}),H({hook:S("state"),id:"state",inputName:"State",placeholder:"State (e.g. Kuala Lumpur)",errorMsg:null==w?void 0:null===(N=w.state)||void 0===N?void 0:N.message}),H({hook:S("country",{validate:e=>"student"!=I||(!e||e.length<1?"Please fill in your country.":void 0)}),id:"country",inputName:"Country",placeholder:"Country (e.g. Malaysia)",errorMsg:null==w?void 0:null===(A=w.country)||void 0===A?void 0:A.message})]}),(0,r.jsxs)(u.Z,{title:"Billing Information",hidden:"teacher"!=I&&"parent"!=I,children:[(0,r.jsx)("div",{className:"text-sm text-center",children:"This will be written on your receipt."}),H({hook:S("billingMobileNumber",{pattern:{value:k().phone,message:"Please enter a valid mobile number."}}),id:"billingMobileNumber",placeholder:"Mobile Number"}),H({hook:S("billingAddressLine1"),id:"billingAddressLine1",placeholder:"Address Line 1"}),H({hook:S("billingAddressLine2"),id:"billingAddressLine2",placeholder:"Address Line 2"}),H({hook:S("billingAddressPostcode"),id:"billingAddressPostcode",placeholder:"Postcode"}),H({hook:S("billingAddressCity"),id:"billingAddressCity",placeholder:"City"}),H({hook:S("billingAddressState"),id:"billingAddressState",placeholder:"State"}),H({hook:S("billingAddressCountry"),id:"billingAddressCountry",placeholder:"Country"})]}),(0,r.jsx)(n.Z,{props:{type:"submit"},isLoading:_,full:!0,children:"Update Details"})]})]})]})}),(0,g.Z)(E)]})}}},function(e){e.O(0,[627,257,414,536,634,888,774,179],function(){return e(e.s=9813)}),_N_E=e.O()}]);